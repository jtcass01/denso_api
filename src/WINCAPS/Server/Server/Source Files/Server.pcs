'!TITLE "Server.pcs"
' AUTHOR : 		Jacob Taylor Cassady
' DESCRIPTION : TCP Server.

#include "methods.pcs"

Sub Main										' START Server
	Dim response as Variant						' Create a variable to store the response

	Comm.Open 4									' Open port number 4 (TCP Server)
	Comm.Clear 4								' Clear port number 4
	Wait Comm.State(4) = 2 						' Wait for connection from the client.
	On Error Goto ErrorHandler					' Create disconnect error handler
	I1 = 0
	Do											' Start a constant loop for reception
		response = Comm.Input(4)				' Recieve input from the user
		PrintDbg "Input recieved: " & response  ' Print the debug the message system.

		Select Case response					' BEGIN SWITCH
		Case "method_1"							' Case for func_1
			call method_1()
		Case "method_2"							' Case for func_2
			call method_2()
		Case "method_3"	                        ' Case for func_3
			call method_3()
		Case Else								' default case
			call improper_response()
		End Select								' END SWITCH

		Delay 1
	Loop Until I1<>0

	Comm.Close 4								' Close port 4
	Exit Sub									' END MAIN


ErrorHandler:									' BEGIN ERRORHANDLER
	Comm.Close 4, -1 							' Error occured disconnect from port 4
	PrintDbg "Err = " & Hex(Err.OriginalNumber)	' Print error number using hex representation.
	Comm.Open 4									' Open port 4
	Comm.Clear 4								' Clear port 4
	Wait Comm.State(4) = 2 						' Wait for connection from the client
	Resume 										' Clear the error-state, and resume the program from the line where an error occured	


End Sub 										' END Program
